<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
  <head>
    <meta charset="utf-8">
    <title>Shotgun Comparative Analysis HTML Report</title>
    <link rel="apple-touch-icon" sizes="180x180" href="https://cdn.holoviz.org/panel/1.7.1/dist/images/apple-touch-icon.png">
        <link rel="icon" href="https://cdn.holoviz.org/panel/1.7.1/dist/images/favicon.ico" type="">
    <meta name="name" content="Shotgun Comparative Analysis HTML Report">

    <!-- Template JS -->
    <script src="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/bootstrap5/js/bootstrap.bundle.min.js"></script>
    <style>
      html, body {
	display: flow-root;
        box-sizing: border-box;
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/plotlyplot/maplibre-gl@4.4.1/dist/maplibre-gl.css?v=1.7.1" type="text/css" />

<style type="text/css">

:host(.pn-loading):before, .pn-loading:before {
  background-color: #c3c3c3;
  mask-size: auto calc(min(50%, 400px));
  -webkit-mask-size: auto calc(min(50%, 400px));
}
.py-error { display: none; }</style><script src="https://cdn.jsdelivr.net/pyodide/v0.27.5/full/pyodide.js"></script>
<script type="esms-options">{"shimMode": true}</script>

<script type="text/javascript" src="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/reactiveesm/es-module-shims@^1.10.0/dist/es-module-shims.min.js"></script>
<script type="text/javascript" src="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/plotlyplot/plotly-3.0.1.min.js"></script>
<script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-3.7.2.min.js"></script>
<script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-gl-3.7.2.min.js"></script>
<script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-widgets-3.7.2.min.js"></script>
<script type="text/javascript" src="https://cdn.bokeh.org/bokeh/release/bokeh-tables-3.7.2.min.js"></script>
<script type="text/javascript" src="https://cdn.holoviz.org/panel/1.7.1/dist/panel.min.js"></script>

<script type="text/javascript">
  Bokeh.set_log_level("info");
</script>    <!-- Template CSS -->
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/css/listpanel.css">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/css/button.css">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/css/markdown.css">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/css/loading.css?v=1.7.1">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/bootstrap5/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/theme/default.css?v=1.7.1">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/theme/bootstrap_default.css?v=1.7.1">
    <link rel="stylesheet" href="https://cdn.holoviz.org/panel/1.7.1/dist/bundled/bootstraptemplate/bootstrap.css?v=1.7.1">
    <style type="text/css">
    
:host(.pn-loading):before, .pn-loading:before {
  background-color: #c3c3c3;
  mask-size: auto calc(min(50%, 400px));
  -webkit-mask-size: auto calc(min(50%, 400px));
}
    </style>

    <style>
      :root {
	--header-background: #61cfde;
	--header-color: var(--design-primary-text-color, var(--panel-on-primary-color));
	--sidebar-width: 250px;
      }
      #header, #header :host {
	--bs-body-bg: var(--header-background);
	--bs-body-color: var(--header-color);
	--design-background-text-color: var(--header-color);
	--design-background-color: var(--header-background);
	background-color: var(--header-background);
	color: var(--header-color);
      }
      #sidebar {
	max-width: var(--sidebar-width) !important;
	width: var(--sidebar-width);
      }
    </style>
  </head>
  <body class="pn-loading pn-arc">
<div class="container-fluid d-flex flex-column vh-100 overflow-hidden" id="container">
  <nav class="navbar navbar-expand-md sticky-top shadow" id="header">
    <button type="button" id="sidebar-toggle" class="navbar-toggle" data-bs-toggle="collapse" data-bs-target="#sidebar" aria-expanded="true" aria-label="Toggle sidebar" aria-controls="sidebar">
      <span class="navbar-toggler-icon"></span>
    </button>
    <div class="app-header">
<a class="title" href="" >&nbsp;Shotgun Comparative Analysis HTML Report</a>    </div>
    <div id="header-items">
  </nav>

  <div class="row overflow-hidden" id="content">
    <div class="sidenav collapse-horizontal show" id="sidebar">
      <ul class="nav flex-column">
        <div id="af9222b9-556d-4f48-9a7c-2b864ab71d07" data-root-id="p1019" style="display: contents;"></div>
      </ul>
    </div>

    <div class="col mh-100 float-left" id="main">
          <div id="e5d08a9d-d3a9-45cc-886d-8e0c9d8e0310" data-root-id="p1012" style="display: contents;"></div>
    </div>
  </div>

  <div id="pn-Modal" class="modal fade pn-modal" role="dialog" tabindex="-1" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content pn-modal-content">
	<button type="button" id="pn-closeModal" class="btn-close pn-modal-close" data-bs-dismiss="modal" aria-label="Close"></button>
	<div class="modal-body">
	</div>
      </div>
    </div>
  </div>
</div>

<div id="b3959e41-72fc-4e12-862d-b17207b56d43" data-root-id="p1008" style="display: contents;"></div>
<div id="ee5bdc3a-822b-4b29-addb-5d965b088564" data-root-id="p1010" style="display: contents;"></div>
<div id="cf7127e5-dc07-40b0-a102-8637f7ad3901" data-root-id="p1002" style="display: contents;"></div>
<div id="e44ac730-09e4-440a-ad0f-1be99353cc8e" data-root-id="p1011" style="display: contents;"></div>


  
    <script type="text/javascript">
    async function main() {
      let pyodide = await loadPyodide();
      await pyodide.loadPackage("micropip");
      await pyodide.runPythonAsync(`
        import micropip
        await micropip.install(['https://cdn.holoviz.org/panel/wheels/bokeh-3.7.2-py3-none-any.whl', 'https://cdn.holoviz.org/panel/1.7.1/dist/wheels/panel-1.7.1-py3-none-any.whl', 'pyodide-http==0.2.1', 'hvplot', 'matplotlib', 'numpy', 'pandas', 'plotly', 'scipy', 'seaborn']);
      `);
      code = `\nimport asyncio\n\nfrom panel.io.pyodide import init_doc, write_doc\n\ninit_doc()\n\nimport matplotlib.pyplot as plt\nimport hvplot.pandas\nimport numpy as np\nimport pandas as pd\nimport panel as pn\nimport plotly.express as px\nimport warnings\nwarnings.filterwarnings("ignore")\npn.extension('plotly')\nimport pickle\nimport io\nimport seaborn as sns\nfrom scipy.stats import ranksums\n\ndescr=pn.pane.Markdown("""\n\n## Analysis Workflow\n\n1. Host reads removed using Hostile, which aligns to the human T2T-CHM13v2.0 and IPD-IMGT/HLA v3.51 genomic data.\n2. Taxonomic profiling conducted using a Kraken2 database of core genes derived from a curated list of genomes. All metrics and analyses were performed using the raw count data matrix.\n3. Alpha-diversity indices were calculated using the *microbiome* R package, using species count data.\n4. Beta-diversity analyses were performed using the *vegan* and *phyloseq* R packages, using species count data.\n5. PERMANOVA calculations were found using *adonis2* from *vegan* with 999 permutations.\n6. P-value calculations for alpha-diversity distributions was performed with *ranksums* from Python's *scipy.stats* \n\n### Differential Abundance\n\n- ALDEx2 transforms count data using the centered log-ratio method and performs Monte-Carlo sampling from the Dirichlet distribution to estimate the effect size of taxonomic differential abundance.\n\n- LinDA implements a simple, robust and highly scalable approach to tackle the compositional effects in differential abundance analysis. It fits linear regression models on the centered log2-ratio transformed data, identifies a bias term due to the transformation and compositional effect, and corrects the bias using the mode of the regression coefficients. It could fit mixed-effect models.\n\n""", width=600)\n\nglobal comp\nglobal no_tax\n\ntaxonomic_rank=["Phylum","Class","Order","Family","Genus","Species"]\nmeasures=["observed","diversity_inverse_simpson","diversity_shannon"]\nETC=[0.01,0.05,0.1,0.5,1,2]\nstats=["Total Seqs","% Duplicate","%GC","Mean Seq Length"]\nmeta_cols=["Comp1"]\n\n\n################################# CREATE CHARTS ############################\n\n##Full Dataset Taxonomic Profile##\ndef create_stacked_bar(choice,etc):\n    df2=pd.DataFrame()\n\n    ranks=["Phylum","Class","Order","Family","Genus","Species"]\n\n    cols=list(df.columns)\n    ranks.remove(choice)\n\n    set1=set(cols)\n    set2=set(ranks)\n    diff=set1.difference(set2)\n\n    temp=df.drop(columns=ranks)\n\n    df2=temp.groupby(choice,dropna=False).sum()\n\n    df2.reset_index(inplace=True)\n\n    melt=pd.melt(df2,id_vars=choice,value_vars=list(diff))\n    melt[choice].loc[melt['value'] < etc] = "Other"\n\n    fig = px.histogram(melt, x="variable", y="value",color=choice,title=f"{choice} Abundance (<{etc}% as \\'Other\\')",barmode="stack",color_discrete_map=colors)\n    fig.update_layout(yaxis_title="Relative Abundance")\n    fig.update_layout(xaxis_title="")\n    fig.update_traces(textfont_color='black')\n    fig.update_layout(legend=dict(font=dict(size=12)))\n    #fig.update_layout(dict(font=dict(size=14),title_x=0.2,legend=dict(orientation="h",font=dict(size=14),y=-0.30)))\n    \n    return pn.pane.Plotly(fig,width=1200,height=800)\n\n##Full Dataset Alpha Diversity##\ndef create_bar_chart(measure):\n    return al.hvplot.bar(x="index", y=measure, bar_width=0.8, rot=90,width=1200, height=600,fontsize={'ylabel': '3px', 'ticks': 11}).opts(active_tools=[])\n\n##Full Dataset Beta Diversity##\ndef create_scatter_chart(switch):\n    #Add PC variance explained\n    \n    cols=list(bd.columns)\n\n    B=[cols[0],"bray1","bray2","bray3"]\n    A=[cols[0],"ait1","ait2","ait3"]\n\n    bray=bd[B]\n    aitc=bd[A]\n    \n    B_d={"bray1":"1st PC","bray2":"2nd PC","bray3":"3rd PC"}\n    A_d={"ait1":"1st PC","ait2":"2nd PC","ait3":"3rd PC"}\n\n    Bray=bray.rename(columns=B_d)\n    Aitc=aitc.rename(columns=A_d)\n    \n    if switch:\n        fig = px.scatter_3d(Bray, x="1st PC", y="2nd PC", z="3rd PC",text=Bray.index, color=cols[0])\n    else:\n        fig = px.scatter_3d(Bray, x="1st PC", y="2nd PC", z="3rd PC", color=cols[0])\n        \n    fig.update_traces(marker=dict(size=4,line=dict(width=1,color='DarkSlateGrey')))\n    fig.update_layout(margin=dict(l=0, r=0, b=0, t=30))\n    fig.update_layout(legend=dict(font=dict(size=18),itemsizing="constant"))\n\n    if switch:\n        fig2 = px.scatter_3d(Aitc, x="1st PC", y="2nd PC", z="3rd PC",text=Aitc.index, color=cols[0])\n    else:\n        fig2 = px.scatter_3d(Aitc, x="1st PC", y="2nd PC", z="3rd PC", color=cols[0])\n        \n    fig2.update_traces(marker=dict(size=4,line=dict(width=1,color='DarkSlateGrey')))\n    fig2.update_layout(margin=dict(l=0, r=0, b=0, t=30))\n    fig2.update_layout(legend=dict(font=dict(size=18),itemsizing="constant"))\n    \n    Fig=pn.pane.Plotly(fig,width=900,height=600,name="Bray-Curtis")\n    Fig2=pn.pane.Plotly(fig2,width=900,height=600,name="Aitchison")\n\n    tabs = pn.Tabs(Fig, Fig2, dynamic=True)\n\n    return tabs\n\n##Comp Profile##\ndef make_average(temp_tax,etc,choice):\n    comp_group=pd.merge(taxonomy,temp_tax,left_index=True,right_index=True)\n    comp_group.index.name="Species"\n    comp_group.reset_index(inplace=True)\n\n    df=comp_group\n\n    df2=pd.DataFrame()\n\n    ranks=["Phylum","Class","Order","Family","Genus","Species"]\n\n    cols=list(df.columns)\n    for r in ranks:\n        cols.remove(r)\n    ranks.remove(choice)\n\n    temp=df.drop(columns=ranks)\n\n    df2=temp.groupby(choice,dropna=False).sum()\n\n    df2.reset_index(inplace=True)\n\n    melt=pd.melt(df2,id_vars=choice,value_vars=cols)\n\n    melt[choice].loc[melt['value'] < etc] = "Other"\n\n    fig = px.histogram(melt, x="value", y="variable",color=choice,title=f"Average Abundance",barmode="stack",color_discrete_map=colors)\n    fig.update_layout(yaxis_title="Relative Abundance")\n    fig.update_layout(xaxis_title="")\n    fig.update_traces(textfont_color='black')\n    fig.update_layout(title=dict(font=dict(size=16)))\n    fig.update_layout(legend=dict(font=dict(size=12)))\n    \n    return fig\n\ndef create_stacked_bar_column(choice,etc,group):\n    \n    average=pd.DataFrame()\n    Avg=[]\n    figures=[]\n    m=group\n    temp=meta[m]\n    merged=pd.merge(no_tax.T,temp,left_index=True,right_index=True)\n    merged=merged.loc[~merged[m].isna()]\n    \n    for u in merged[m].unique():\n        temp_merged=merged.loc[merged[m]==u]\n        temp_tax=temp_merged.T\n        temp_tax.drop(index=m,inplace=True)\n        length=len(list(temp_tax.columns))\n\n        average[u] = temp_tax.apply(lambda row: row.sum()/length, axis=1)\n        comp_group=pd.merge(taxonomy,temp_tax,left_index=True,right_index=True)\n        comp_group.index.name="Species"\n        comp_group.reset_index(inplace=True)\n        \n        df=comp_group\n    \n        df2=pd.DataFrame()\n\n        ranks=["Phylum","Class","Order","Family","Genus","Species"]\n        cols=list(df.columns)\n        for r in ranks:\n            cols.remove(r)\n        ranks.remove(choice)\n\n        temp=df.drop(columns=ranks)\n\n        df2=temp.groupby(choice,dropna=False).sum()\n\n        df2.reset_index(inplace=True)\n\n        melt=pd.melt(df2,id_vars=choice,value_vars=cols)\n\n        melt[choice].loc[melt['value'] < etc] = "Other"\n\n\n        fig = px.histogram(melt, x="variable", y="value",color=choice,title=f"{u}",barmode="stack",color_discrete_map=colors)\n        \n        fig.update_layout(yaxis_title="Relative Abundance")\n        fig.update_layout(xaxis_title="")\n        fig.update_traces(textfont_color='black')\n        fig.update_layout(title=dict(font=dict(size=16)))\n        fig.update_yaxes(title_font = {"size": 14})\n        fig.update_layout(legend=dict(font=dict(size=12)))\n        \n        figures.append(fig)\n        \n    Avg.append(make_average(average,etc,choice))\n    \n    Full=Avg+figures\n    \n    return pn.Column(*[pn.pane.Plotly(fig,width=1200,height=600) for fig in Full])\n\n#Comp Stats##\ndef create_full_comp(switch,group):\n    mark=pn.pane.Markdown(f"## {Comps[group][0]} vs. {Comps[group][1]}")\n    \n    alf=comp[group][0]\n    beta=comp[group][1]\n    perm=comp[group][2]\n    aldex=comp[group][3]\n    linda=comp[group][4]\n\n    ### Alpha Diversity ###\n\n    merge=pd.merge(alf,meta,left_index=True,right_index=True)\n\n    feats=["observed","diversity_inverse_simpson","diversity_shannon"]\n\n    fig,ax = plt.subplots(1, 3, dpi=200,figsize=(10, 5))\n    col=group\n    for c,feat in enumerate(feats):\n        title=""\n        temp=feat.split("_")\n        for t in temp:\n            title+=t[0].upper()\n            title+=t[1:]\n            if len(temp) > 1:\n                title+=" "\n\n        ymax=round(merge[feat].max())\n\n        melt=pd.melt(merge,id_vars=[col],value_vars=[feat])\n\n        diff=[]\n        for u in list(merge[col].unique()):\n            diff.append(merge.loc[merge[col]==u])\n\n        d1=list(diff[0][feat])\n        d84=list(diff[1][feat])\n\n        pval=round(ranksums(d1, d84)[1], 4)\n\n        sns.boxplot(data=melt, x=col, y="value",palette="Greys",ax=ax[c],hue=col,legend=False)\n\n        inc=(ymax*0.02)\n\n        idx1=0\n        idx2=1\n\n        ymax+=inc\n        ymin=melt["value"].min() - (ymax*0.1)\n\n        pltx=[idx1,idx1,idx2,idx2]\n        plty=[ymax, ymax+inc, ymax+inc, ymax]\n\n        text=f"p-value={pval}"\n        summ=idx1+idx2\n\n        ax[c].text(summ*.5, ymax+inc*2, text, ha='center', va='bottom', color="black")\n        ax[c].plot(pltx, plty, lw=1.5, c="black")\n\n        ax[c].set_title(title, fontsize=12)\n        ax[c].set_ylabel("")\n        ax[c].set_xlabel("")\n        ax[c].set_ylim(ymin,ymax+(ymax*0.1))\n    \n    alpha_fig=pn.pane.Matplotlib(fig,width=900,height=600,name="Alpha Diversity")\n    \n    ### BETA-DIVERSITY ###\n\n    #Need to add PC variance explained\n    B=[group,"bray1","bray2","bray3"]\n    A=[group,"ait1","ait2","ait3"]\n\n    bray=beta[B]\n    aitc=beta[A]\n    \n    B_d={"bray1":"1st PC","bray2":"2nd PC","bray3":"3rd PC"}\n    A_d={"ait1":"1st PC","ait2":"2nd PC","ait3":"3rd PC"}\n\n    Bray=bray.rename(columns=B_d)\n    Aitc=aitc.rename(columns=A_d)\n    \n    if switch:\n        fig = px.scatter_3d(Bray, x="1st PC", y="2nd PC", z="3rd PC",text=Bray.index, color=group)\n    else:\n        fig = px.scatter_3d(Bray, x="1st PC", y="2nd PC", z="3rd PC", color=group)\n        \n    fig.update_traces(marker=dict(size=4,line=dict(width=1,color='DarkSlateGrey')))\n    fig.update_layout(margin=dict(l=0, r=0, b=0, t=30))\n    fig.update_layout(legend=dict(font=dict(size=18),itemsizing="constant"))\n\n    if switch:\n        fig2 = px.scatter_3d(Aitc, x="1st PC", y="2nd PC", z="3rd PC",text=Aitc.index, color=group)\n    else:\n        fig2 = px.scatter_3d(Aitc, x="1st PC", y="2nd PC", z="3rd PC", color=group)\n        \n    fig2.update_traces(marker=dict(size=4,line=dict(width=1,color='DarkSlateGrey')))\n    fig2.update_layout(margin=dict(l=0, r=0, b=0, t=30))\n    fig2.update_layout(legend=dict(font=dict(size=18),itemsizing="constant"))\n    \n    Fig=pn.pane.Plotly(fig,width=900,height=600,name="Bray-Curtis")\n    Fig2=pn.pane.Plotly(fig2,width=900,height=600,name="Aitchison")\n\n    ##PERMANOVA DF###\n\n    permanova = pn.pane.DataFrame(perm, width=400, name="PERMANOVA")\n\n    ##ALDEx2 DF###\n    \n    Aldex = pn.pane.DataFrame(aldex, width=400, name="ALDEx2 DA")\n    \n    ##ALDEx2 Bar Chart###\n    \n    adding=[]\n\n    comp_lab=Comps[group]\n    lizt=list(aldex.index)\n    for i in range(0,len(lizt)):\n        ef=aldex.iloc[i,0].item()\n        if ef < 0:\n            adding.append(comp_lab[0])\n        elif ef > 0:\n            adding.append(comp_lab[1])\n\n    aldex['c']=adding\n    fig=px.bar(aldex, x="Effect Size", y=aldex.index, color=aldex.index)\n    fig.update_layout(showlegend=False)\n    fig.update_layout(yaxis_title="")\n    Fig4=pn.Column(pn.pane.Markdown(f'## Negative values enriched in {Comps[group][0]} | Positive values enriched in {Comps[group][1]}'),pn.pane.Plotly(fig),name="ALDEx2 Chart")\n\n    ##LinDA DF###\n    Linda = pn.Column(pn.pane.Markdown(f"## Fold change relative to {Comps[group][1]}"),pn.pane.DataFrame(linda, width=400), name="LinDA DA")\n\n    ##LinDA Bar Chart###\n\n    sc = px.scatter(linda, x="log2FoldChange", y="P-value",text=linda.index)\n    Fig3=pn.Column(pn.pane.Markdown(f"## Fold change relative to {Comps[group][1]}"),pn.pane.Plotly(sc,width=900,height=600),name="LinDA Chart")\n    \n    tabs = pn.Tabs(alpha_fig,Fig, Fig2, permanova, Aldex, Fig4, Linda, Fig3, dynamic=True)\n\n    return pn.Column(mark,tabs)\n\n############################# WIDGETS & CALLBACK ###########################\n# https://tabler-icons.io/\nbutton1 = pn.widgets.Button(name="Introduction and Methods", button_type="warning", styles={"height": "50px","width": "100%"})\nbutton3 = pn.widgets.Button(name="Composition", button_type="warning", styles={"height":"50px","width": "100%"})\nbutton4 = pn.widgets.Button(name="Full Dataset Alpha", button_type="warning", styles={"height":"50px","width": "100%"})\nbutton5 = pn.widgets.Button(name="Full Dataset Beta", button_type="warning", styles={"height":"50px","width": "100%"})\nbutton6 = pn.widgets.Button(name="Comparative Tax Profile", button_type="warning", styles={"height":"50px","width": "100%"})\nbutton7 = pn.widgets.Button(name="Comparative Statistics", button_type="warning", styles={"height":"50px","width": "100%"})\n\nseq = pn.widgets.Select(name="Statistic", options=stats)\nrank = pn.widgets.Select(name="Taxonomic Rank", options=taxonomic_rank)\nalpha = pn.widgets.Select(name="Measure", options=measures)\netc = pn.widgets.Select(name="Group Rare Taxa as 'Other' (%)", options=ETC)\nswitch = pn.widgets.Switch(name='Something else')\ngroups=pn.widgets.Select(name="Comparative Group", options=meta_cols)\n\ndef show_page(page_key):\n    mapping = {\n        "Page1": CreatePage1(),\n        "Page3": CreatePage3(),\n        "Page4": CreatePage4(),\n        "Page5": CreatePage5(),\n        "Page6": CreatePage6(),\n        "Page7": CreatePage7(),\n    }\n    \n    main_area.clear()\n    main_area.append(mapping[page_key])\n\n############################ CREATE PAGE LAYOUT ##############################\ndef CreatePage1():\n    return pn.Column(descr,align=("start","end"))\n\ndef CreatePage3():\n    #Taxonomic\n    return pn.Column(pn.pane.Markdown("## Composition"),pn.Row(rank,etc),pn.bind(create_stacked_bar,choice=rank,etc=etc),align="center")\n\ndef CreatePage4():\n    #Alpha\n    return pn.Column(pn.pane.Markdown("## Alpha-diversity"),alpha,pn.bind(create_bar_chart,measure=alpha),align="center")\n\ndef CreatePage5():\n    #Beta\n    return pn.Column(pn.pane.Markdown("## Full Dataset Beta-diversity"),pn.Row(switch,"Toggle sample labeling in plot"),pn.bind(create_scatter_chart,switch=switch),align="center")\n\ndef CreatePage6():\n    #Comparative taxonomic\n    return pn.Column(pn.pane.Markdown("## Comparative Analysis - Taxonomic Composition"),pn.Row(rank,etc,groups),pn.bind(create_stacked_bar_column,choice=rank,etc=etc,group=groups),align="center")\n\ndef CreatePage7():\n    #Comparative module\n    return pn.Column(pn.pane.Markdown("## Comparative Analysis Statitics"),pn.Row(groups,switch,"Toggle sample labeling in beta-diversiy plot"),pn.bind(create_full_comp,switch=switch,group=groups),align="center")\n\n########Initialization#########\n\n\ndef main():\n\n\n    button1.on_click(lambda event: show_page("Page1"))\n    button3.on_click(lambda event: show_page("Page3"))\n    button4.on_click(lambda event: show_page("Page4"))\n    button5.on_click(lambda event: show_page("Page5"))\n    button6.on_click(lambda event: show_page("Page6"))\n    button7.on_click(lambda event: show_page("Page7"))\n\n\n    sidebar2 = pn.Column(pn.pane.Markdown("## Pages"), button1, button3, button4, button5, button6, button7, styles={"width": "100%", "padding": "15px"})\n    sidebar.clear()\n    sidebar.append(sidebar2)\n\n\n#################### FILE INPUT ##########################\n\nDF = pn.widgets.FileInput(accept=".pkl")\n\nconfirmButton1 = pn.widgets.Button(name="Confirm")\n\ndef get_data(file):\n    if file is not None:\n        d = pickle.load(io.BytesIO(file))\n        return d[0],d[1],d[2],d[3],d[4],d[5],d[6],d[7],d[8]\n\ndata1 = pn.bind(get_data, DF)\n\ndf = pd.DataFrame()\ntaxonomy = pd.DataFrame()\nno_tax = pd.DataFrame()\nal = pd.DataFrame()\nrd = pd.DataFrame()\nmeta = pd.DataFrame()\ncolors={}\nComps={}\ncomp={}\n\ndef confirmselection1(file):\n    global df\n    global taxonomy\n    global no_tax\n    global meta\n    global al\n    global bd\n    global comp\n    global colors\n    global Comps\n\n    df,taxonomy,no_tax,meta,al,bd,comp,colors,Comps = data1()\n    main()\n   \nconfirmButton1.on_click(confirmselection1)\n\nsidebar = pn.Column(pn.pane.Markdown("## Pages"), styles={"width": "100%", "padding": "15px"})\n\n#################### MAIN AREA LAYOUT ##########################\nmain_area = pn.Column(pn.Row(DF, confirmButton1, pn.pane.Markdown("## Upload data.pkl file and click Confirm")),styles={"width":"100%"})\n\n\n###################### APP LAYOUT ##############################\ntemplate = pn.template.BootstrapTemplate(\n    title="Shotgun Comparative Analysis HTML Report",\n    sidebar=[sidebar],\n    main=[main_area],\n    header_background="#61cfde", \n    sidebar_width=250, ## Default is 330\n    busy_indicator=None,\n)\n\n# Serve the Panel app\ntemplate.servable()\n\n\nawait write_doc()`
      await pyodide.runPythonAsync(code);
    }
    main();
    </script>
    <script type="application/json" id="p1024">
      {"f9c87ce2-f326-4b95-835b-ab4b0bbd57ad":{"version":"3.7.2","title":"Shotgun Comparative Analysis HTML Report","roots":[{"type":"object","name":"panel.models.location.Location","id":"p1002","attributes":{"name":"location","reload":false}},{"type":"object","name":"panel.models.markup.HTML","id":"p1008","attributes":{"name":"js_area","stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"type":"object","name":"ImportedStyleSheet","id":"p1006","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.1/dist/css/loading.css"}},{"type":"object","name":"ImportedStyleSheet","id":"p1023","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.1/dist/bundled/theme/bootstrap.css"}}],"width":0,"height":0,"margin":0,"sizing_mode":"fixed","align":"start","disable_math":true}},{"type":"object","name":"panel.models.reactive_html.ReactiveHTML","id":"p1010","attributes":{"name":"actions","subscribed_events":{"type":"set","entries":["dom_event"]},"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"id":"p1023"}],"margin":0,"align":"start","data":{"type":"object","name":"BootstrapTemplateActions1","id":"p1009","attributes":{"name":"BootstrapTemplateActions00281","tags":["__ref:p1010"]}},"scripts":{"type":"map","entries":[["render",["state.modal = new bootstrap.Modal(document.getElementById(&amp;#x27;pn-Modal&amp;#x27;))"]],["open_modal",["state.modal.show()"]],["close_modal",["state.modal.hide()"]]]}}},{"type":"object","name":"panel.models.browser.BrowserInfo","id":"p1011","attributes":{"name":"browser_info"}},{"type":"object","name":"panel.models.layout.Column","id":"p1012","attributes":{"name":"main-134662463408400","tags":["main"],"styles":{"type":"map","entries":[["width","100%"]]},"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"type":"object","name":"ImportedStyleSheet","id":"p1007","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.1/dist/css/listpanel.css"}},{"id":"p1023"}],"margin":0,"align":"start","children":[{"type":"object","name":"Row","id":"p1013","attributes":{"name":"Row00272","stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"id":"p1007"},{"id":"p1023"}],"margin":0,"align":"start","children":[{"type":"object","name":"FileInput","id":"p1014","attributes":{"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"id":"p1023"}],"margin":[5,10],"align":"start","accept":".pkl"}},{"type":"object","name":"panel.models.widgets.Button","id":"p1016","attributes":{"subscribed_events":{"type":"set","entries":["button_click"]},"css_classes":["solid"],"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"type":"object","name":"ImportedStyleSheet","id":"p1015","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.1/dist/css/button.css"}},{"id":"p1023"}],"margin":[5,10],"align":"start","label":"Confirm"}},{"type":"object","name":"panel.models.markup.HTML","id":"p1018","attributes":{"css_classes":["markdown"],"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"type":"object","name":"ImportedStyleSheet","id":"p1017","attributes":{"url":"https://cdn.holoviz.org/panel/1.7.1/dist/css/markdown.css"}},{"id":"p1023"}],"margin":[5,10],"align":"start","text":"&amp;lt;h2 id=&amp;quot;upload-datapkl-file-and-click-confirm&amp;quot;&amp;gt;Upload data.pkl file and click Confirm &amp;lt;a class=&amp;quot;header-anchor&amp;quot; href=&amp;quot;#upload-datapkl-file-and-click-confirm&amp;quot;&amp;gt;\u00b6&amp;lt;/a&amp;gt;&amp;lt;/h2&amp;gt;\n"}}]}}]}},{"type":"object","name":"panel.models.layout.Column","id":"p1019","attributes":{"name":"nav-134662467812192","tags":["nav"],"styles":{"type":"map","entries":[["width","100%"],["padding","15px"]]},"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"id":"p1007"},{"id":"p1023"}],"margin":0,"align":"start","children":[{"type":"object","name":"panel.models.markup.HTML","id":"p1020","attributes":{"css_classes":["markdown"],"stylesheets":["\n:host(.pn-loading):before, .pn-loading:before {\n  background-color: #c3c3c3;\n  mask-size: auto calc(min(50%, 400px));\n  -webkit-mask-size: auto calc(min(50%, 400px));\n}",{"id":"p1006"},{"id":"p1017"},{"id":"p1023"}],"margin":[5,10],"align":"start","text":"&amp;lt;h2 id=&amp;quot;pages&amp;quot;&amp;gt;Pages &amp;lt;a class=&amp;quot;header-anchor&amp;quot; href=&amp;quot;#pages&amp;quot;&amp;gt;\u00b6&amp;lt;/a&amp;gt;&amp;lt;/h2&amp;gt;\n"}}]}}],"defs":[{"type":"model","name":"ReactiveHTML1"},{"type":"model","name":"FlexBox1","properties":[{"name":"align_content","kind":"Any","default":"flex-start"},{"name":"align_items","kind":"Any","default":"flex-start"},{"name":"flex_direction","kind":"Any","default":"row"},{"name":"flex_wrap","kind":"Any","default":"wrap"},{"name":"gap","kind":"Any","default":""},{"name":"justify_content","kind":"Any","default":"flex-start"}]},{"type":"model","name":"FloatPanel1","properties":[{"name":"config","kind":"Any","default":{"type":"map"}},{"name":"contained","kind":"Any","default":true},{"name":"position","kind":"Any","default":"right-top"},{"name":"offsetx","kind":"Any","default":null},{"name":"offsety","kind":"Any","default":null},{"name":"theme","kind":"Any","default":"primary"},{"name":"status","kind":"Any","default":"normalized"}]},{"type":"model","name":"GridStack1","properties":[{"name":"ncols","kind":"Any","default":null},{"name":"nrows","kind":"Any","default":null},{"name":"allow_resize","kind":"Any","default":true},{"name":"allow_drag","kind":"Any","default":true},{"name":"state","kind":"Any","default":[]}]},{"type":"model","name":"drag1","properties":[{"name":"slider_width","kind":"Any","default":5},{"name":"slider_color","kind":"Any","default":"black"},{"name":"value","kind":"Any","default":50}]},{"type":"model","name":"click1","properties":[{"name":"terminal_output","kind":"Any","default":""},{"name":"debug_name","kind":"Any","default":""},{"name":"clears","kind":"Any","default":0}]},{"type":"model","name":"FastWrapper1","properties":[{"name":"object","kind":"Any","default":null},{"name":"style","kind":"Any","default":null}]},{"type":"model","name":"NotificationArea1","properties":[{"name":"js_events","kind":"Any","default":{"type":"map"}},{"name":"max_notifications","kind":"Any","default":5},{"name":"notifications","kind":"Any","default":[]},{"name":"position","kind":"Any","default":"bottom-right"},{"name":"_clear","kind":"Any","default":0},{"name":"types","kind":"Any","default":[{"type":"map","entries":[["type","warning"],["background","#ffc107"],["icon",{"type":"map","entries":[["className","fas fa-exclamation-triangle"],["tagName","i"],["color","white"]]}]]},{"type":"map","entries":[["type","info"],["background","#007bff"],["icon",{"type":"map","entries":[["className","fas fa-info-circle"],["tagName","i"],["color","white"]]}]]}]}]},{"type":"model","name":"Notification","properties":[{"name":"background","kind":"Any","default":null},{"name":"duration","kind":"Any","default":3000},{"name":"icon","kind":"Any","default":null},{"name":"message","kind":"Any","default":""},{"name":"notification_type","kind":"Any","default":null},{"name":"_rendered","kind":"Any","default":false},{"name":"_destroyed","kind":"Any","default":false}]},{"type":"model","name":"TemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"BootstrapTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"TemplateEditor1","properties":[{"name":"layout","kind":"Any","default":[]}]},{"type":"model","name":"MaterialTemplateActions1","properties":[{"name":"open_modal","kind":"Any","default":0},{"name":"close_modal","kind":"Any","default":0}]},{"type":"model","name":"ReactiveESM1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"JSComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"ReactComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"AnyWidgetComponent1","properties":[{"name":"esm_constants","kind":"Any","default":{"type":"map"}}]},{"type":"model","name":"request_value1","properties":[{"name":"fill","kind":"Any","default":"none"},{"name":"_synced","kind":"Any","default":null},{"name":"_request_sync","kind":"Any","default":0}]}]}}
    </script>
    <script type="text/javascript">
      (function() {
        const fn = function() {
          Bokeh.safely(function() {
            (function(root) {
              function embed_document(root) {
              const docs_json = document.getElementById('p1024').textContent;
              const render_items = [{"docid":"f9c87ce2-f326-4b95-835b-ab4b0bbd57ad","roots":{"p1002":"cf7127e5-dc07-40b0-a102-8637f7ad3901","p1008":"b3959e41-72fc-4e12-862d-b17207b56d43","p1010":"ee5bdc3a-822b-4b29-addb-5d965b088564","p1011":"e44ac730-09e4-440a-ad0f-1be99353cc8e","p1012":"e5d08a9d-d3a9-45cc-886d-8e0c9d8e0310","p1019":"af9222b9-556d-4f48-9a7c-2b864ab71d07"},"root_ids":["p1002","p1008","p1010","p1011","p1012","p1019"]}];
              root.Bokeh.embed.embed_items(docs_json, render_items);
              }
              if (root.Bokeh !== undefined) {
                embed_document(root);
              } else {
                let attempts = 0;
                const timer = setInterval(function(root) {
                  if (root.Bokeh !== undefined) {
                    clearInterval(timer);
                    embed_document(root);
                  } else {
                    attempts++;
                    if (attempts > 100) {
                      clearInterval(timer);
                      console.log("Bokeh: ERROR: Unable to run BokehJS code because BokehJS library is missing");
                    }
                  }
                }, 10, root)
              }
            })(window);
          });
        };
        if (document.readyState != "loading") fn();
      else document.addEventListener("DOMContentLoaded", fn, {once: true});
      })();
    </script>
  </body>
</html>